@page "{currentPage:int?}"
@model IndexModel
@{
    ViewData["Title"] = "Home";
}
@section Styles {
    <link rel="stylesheet" href="~/css/pages/index.css" />
}

@for(var i = 0; i < Model.ProjectList.Count; i += 4)
{
    <div class="flex-row">
        @for(var j = 0; j < 4 && i + j < Model.ProjectList.Count; j++)
        {
            var project = Model.ProjectList[i + j];
            <div class="flex-cell">
                <div class="project @project.Status.ToLower()">
                    <div class="header">
                        <a class="title" asp-page="/Project" asp-route-shortId="@project.ShortId" title="@project.Name">@project.Name</a>
                        <small>ID: @project.ShortId</small>
                    </div>            
                    <a asp-page="/Project" asp-route-shortId="@project.ShortId">
                        <img src="/ProjectFiles/@project.ShortId/@project.GalleryInfoList.First().RelativePath" alt="Project Image" />
                    </a>
                    <div class="footer">
                        @{ var doneStls = project.StlInfoList.Sum(s => s.Status == "Done" ? 1 : 0); }
                        @if(doneStls == project.StlInfoList.Count)
                        {
                            <div class="info">
                                <i class="fa fa-cubes" aria-hidden="true"></i> STLs: @project.StlInfoList.Count                        
                            </div>
                        }
                        else
                        {
                            <div class="info">
                                <i class="fa fa-cubes" aria-hidden="true"></i> STLs: @project.StlInfoList.Count (Done: @doneStls)                      
                            </div>
                        }              
                        <div class="info">
                            <i class="fa fa-cogs" aria-hidden="true"></i> Status: @project.Status
                        </div>            
                        <div class="info">
                            <i class="fa fa-calendar" aria-hidden="true"></i> Last Update: @project.LastUpdate.ToShortDateString()
                        </div> 
                    </div>
                </div>
            </div>
        }
    </div>
}

@if(Model.TotalPages > 1)
{
    <div class="pagination-wrapper">
        <div class="pagination">
            @if(Model.CurrentPage > 1)
            {
                <a asp-page="/Index" asp-route-currentPage="@(Model.CurrentPage-1)" class="page-link">
                    <i class="fa fa-chevron-left" aria-hidden="true"></i>
                </a>
            }    
            @for(var i = 1; i <= Model.TotalPages; i++)
            {
                <a asp-page="/Index" asp-route-currentPage="@i" class="page-link @(i == Model.CurrentPage ? "active" : "")">@i</a>
            }
            @if(Model.CurrentPage < Model.TotalPages)
            {
                <a asp-page="/Index" asp-route-currentPage="@(Model.CurrentPage+1)" class="page-link">
                    <i class="fa fa-chevron-right" aria-hidden="true"></i>
                </a>
            }  
        </div>
    </div>
}